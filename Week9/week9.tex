\documentclass{beamer}

% TODO: improve the class

\input{beamerpreamble.tex}

\title[]{Programming Challenges}
\subtitle[]{Week 9 - Geometry}
\author[Claus Aranha]{Claus Aranha\\{\footnotesize caranha\@@cs.tsukuba.ac.jp}}
\institute{College of Information Sciences}
\date{2015-06-22\\{\tiny Last updated \today}}

\begin{document}

\begin{frame}
\maketitle
\end{frame}


%%%%%%%%%%%%%%%%%%%%%
\section{Lines}
\subsection{Introduction}

\begin{frame}
  \frametitle{Introduction}
  \begin{block}{Geometry}
    Problems related to points, lines, angles and circles.\\ Usually
    there will be more than one way to calculate.
  \end{block}

  \begin{block}{Geometrical Constructs}
    Lines, Segmenst, Planes, Circles, Convex Polygons, Concave Polygons, etc...
  \end{block}
  
  \begin{block}{Geometrical Computing}
    Our main concern, are \structure{degeneracies} and
    \structure{instability}
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{Degeneracies}
  \begin{block}{Numerical Instability}
    \begin{equation*}
      \arcsin{(\sin{(\pi/4)})} \neq \pi/4 
    \end{equation*}
    Don't forget that operations with real numbers are not guaranteed
    to be precise;
  \end{block}

  \begin{block}{Degeneracies}
    Special cases for geometric calculations. Normally caused by
    divisions by zero. But sometimes have other sources.
    \begin{equation*}
      \tan{(\pi/2)} = \frac{\sin{(\pi/2)}}{\cos{(\pi/2)}} = \frac{1}{0}
    \end{equation*}
  \end{block}
\end{frame}

\subsection{Line}

\begin{frame}
  \frametitle{Line (1)}
  
  \begin{block}{Characteristics}
    \begin{itemize}
    \item Infinite;
    \item Divide a plan into two;
    \item Segment -- a limited line
    \end{itemize}
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{Line (2)}
  \begin{block}{Representation  -- Two Points}
    \begin{itemize}
      \item A line can be described by two points; 
      \item $(x_0,y_0),(x_1,y_1)$
    \end{itemize}
  \end{block}

  \begin{block}{Problems with this representation}
    \begin{itemize}
    \item Not unique: We can have two identical lines represented by different points
    \item Calculating extra points requires interpolation;
    \end{itemize}
  \end{block}

\end{frame}

\begin{frame}
  \frametitle{Line (3)}
  \begin{block}{Representation -- Point and angle}
    \begin{center}
      $ y = mx + b$
    \end{center}
    \medskip

    \begin{itemize}
    \item m (slope): $\frac{y_1 - y_0}{x_1 - x_0}$
    \item b (y-intercept): the point where $x = 0$;
    \end{itemize}
  \end{block}

  \bigskip
  
  Problem: When the line is vertical, we have a degeneration (division by zero on the slope) 
\end{frame}

%% TODO: rethink this slide to guarantee it is both correct and easy to understand!
\begin{frame}[singleframe,fragile]
  \frametitle{Line (4)}
  \begin{block}{Representation -- Point and angle 2}
    \begin{center}
      $ay + bx + c = 0$\\
      or\\
      $x = c$\\
      When the line is vertical
    \end{center}
  \end{block}
\begin{verbatim}
p2l(double[] p1, double[] p2):
   if (p1[0] == p2[0]): // vertical line
      l.a = 1;
      l.b = 0;
      l.c = -p1[0];
   else:
      l.b = 1;
      l.a = -(p1[1]-p2[1])/(p1[0]-p2[0]);
      l.c = -(l.a*p1[0])-(l.b*p1[1]);
\end{verbatim}
\end{frame}

\subsection{Line Intersection}
\begin{frame}[fragile,singleslide]
  \frametitle{Line Intersection (1)}
  \begin{block}{Line Intersection}
    We can calculate if two lines are parallel quickly, by checking if
    their inclination is the same. Note the Epsilon!
  \end{block}
  \smallskip
{\smaller
\begin{verbatim}
parallelQ(line l1, line l2):
   return ((abs(l1.a-l2.a) <= EPSILON)&&
           (abs(l1.b-l2.b) <= EPSILON))
\end{verbatim}
}
\end{frame}

\begin{frame}[fragile,singleslide]
  \frametitle{Line Intersection (2)}
  \begin{block}{Line Intersection Point}
    If the lines are not parallel, they have one intersection point.
    \begin{equation*}
      x = \frac{b_2 - b_1}{m_1 - m_2}, y = m_1\frac{b_2-b_1}{m_1-m_2} + b_1
    \end{equation*}
  \end{block}
  \smallskip
{\smaller
\begin{verbatim}
intersection_point(line l1, line l2):
   if (!(parallelQ(l1,l2))):
      p[0] = (l2.b*11.c - l1.b*12.c)/
             (l2.a*l1.b - l1.a*l2.b);
      if (abs(l1.b) > EPSILON): // Vertical?
         p[1] = - (l1.a*(p[X])+l1.c)/l1.b;
      else:
         p[1] = - (12.a*(p[X])+l2.c)/l2.b;
\end{verbatim}
}
\end{frame}

\begin{frame}[singleslide,fragile]
  \frametitle{Line Intersection (3)}
  \begin{block}{Angle between two lines}
    Two non parallel lines will always intersect at a given angle. If
    the lines are in the $ax+by+c=0$ format, we can calculate their
    angles as follows:
  \end{block}
\begin{verbatim}
intersection_angle(line l1, line l2):
    num = l1.a*l2.b - l2.a*l1.b
    den = l1.a*l2.a * l1.b*l2.b
    return(tan(num/den))
\end{verbatim}
\end{frame}

\begin{frame}
  \frametitle{Line Intersection (4)}
  \begin{block}{Closest Point}
    {\small
    \begin{itemize}
      \item The closest point $p_l$ in a line $l$ to point $p$, is the point
        where the line $(p,p_l)$ intersects $l$.
      \item Closest point can be used to find the distance between a
        line and a point ($d(p,p_l)$);
    \end{itemize}
    }
  \end{block}
  \begin{itemize}
  \item Degenerate/Easy cases: $p$ is in $l$, $l$ is vertical, $l$ is horizontal;
  \item The slope $m$ of the line $(p,p_l)$ is $\frac{1}{l.a}$;
  \item Calculate the intersection between $(p,p_l)$ and $l$;
  \end{itemize}
\end{frame}

% Add an algorithm for closest point to a line

\subsection{segments}
\begin{frame}[fragile,singleslide]
  \frametitle{Line Segments (1)}
  \begin{block}{}
    Line segments are lines delimited by start and end points;
  \end{block}

\begin{verbatim}
   typedef struct {
       point p1,p2
   } segment;
\end{verbatim}
\bigskip

\end{frame}

\begin{frame}
  \frametitle{Line Segments (2)}

  \begin{block}{Degenerative Cases}
    \begin{itemize}
    \item Are the Segments in the same line? (test for same points)
    \item Are the Segments parallel? (no intersection)
    \end{itemize}
  \end{block}

  \begin{itemize}
  \item Calculate the intersecting point between the lines.
  \item Test if this point is whithin a rectangle defined by each line
    segment.
  \end{itemize}
\end{frame}



\section{Triangles}

\subsection{Basics}
\begin{frame}
  \frametitle{Triangles (1)}
  \begin{block}{}
    \begin{itemize}
    \item Polygon defined by three line segments;
    \item Characterized by the relationship between its angles and the
      line segment sizes;
    \item Commonly used to represent more complex polygons;
    \end{itemize}
  \end{block}

  \begin{block}{Manipulating angles}
    \begin{itemize}
    \item Angles can be represented by radians (0 to $2\pi$) or
      degrees (0 to 360);
    \item Mixing the two of them is an easy way to insert bugs in your code;
    \item Make sure what is the usual input for your library's
      trigonometric functons;
      
    \end{itemize}
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{Triangles (2)}
  \begin{block}{Basic Triangle Facts}
    \begin{itemize}
    \item Three angles, summing to a total of 180 degrees ($\pi$~radians);
    \item Law of sines (A,B,C are angles; a,b,c are opposite edges):
      \begin{equation*}
        \frac{a}{\sin{A}} = \frac{b}{\sin{B}} = \frac{c}{\sin{C}}
      \end{equation*}
      \item Law of Cosines:
      \begin{equation*}
        a^2 = b^2+c^2 - 2bc\cos{(A)}
      \end{equation*} 
    \end{itemize}
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{Triangles (3)}
  \begin{block}{Right Triangles}
    A right triangle has one angle with 90 degrees ($\pi/2$ radians). It has many neat properties;
  \end{block}
  For $\alpha$ a non-right angle, with an \emph{opposite} side and an \emph{adjacent} side;
    \begin{itemize}
    \item cos($\alpha$) = $\frac{|adjacent|}{|hypotenuse|}$
    \item sin($\alpha$) = $\frac{|opposite|}{|hypotenuse|}$
    \item tan($\alpha$) = $\frac{|opposite|}{|adjacent|}$
    \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Triangles (4)}
  \begin{block}{Common problems with triangles}
    \begin{itemize}
      \item Given two angles and a side, find the rest;
      \item Given two sides and an angle, find the rest;
      \item Given a side and a height, find the rest;
      \item Etc;
    \end{itemize}
  \end{block}
\end{frame}

\subsection{Area and Signed Area}
\begin{frame}
  \frametitle{Triangles (5)}
  \begin{block}{Area of a Triangle}
    $a$ is the altitude, $h$ is the base;
    \begin{equation*}
      A(T) = (1/2)ah
    \end{equation*}
  \end{block}

  \begin{block}{Signed area}
    $a$,$b$,$c$ are the points of a triangle. 
    \begin{equation*}
      (a_xb_y - a_yb_x + a_yc_x - a_xc_y + b_xc_y - c_xb_y)/2
    \end{equation*}
  \end{block}
  {\smaller
    \begin{itemize}
    \item Negative signed area: a,b,c are clockwise;
    \item Positive signed area: a,b,c are counterclockwise;
    \item Zero signed area: a,b,c are collinear;
    \end{itemize}
  }
   % image: triangle, altitude, base
\end{frame}

\section{Circles}
\subsection{circles}


\begin{frame}
  \frametitle{Circle 1}
  \begin{block}{Representation}
    \begin{itemize}
      \item Center point and radius;
      \item Three boundary points;
    \end{itemize}
  \end{block}
  \begin{block}{Measures}
    \begin{itemize}
    \item Area: $\pi r^2$
    \item Circumference: $2\pi r$
    \end{itemize}
  \end{block}
\end{frame}


\begin{frame}
  \frametitle{Circle 2}
  \begin{block}{Intersection between line and circle}
    Radius $r$ and distance between center and line $d$;
    \begin{itemize}
    \item $d > r$ -- no intersection;
    \item $d == r$ -- tangent, one intersection;
    \item $d < r$ -- two intersection points;
    \end{itemize}
  \end{block}
  \begin{block}{Intersection between two circles}
  \begin{itemize}
    \medskip
  \item Two circles will intersect if the distance to their centers $\leq r_1+r_2$
  \item The points of intersection form triangles with determined
    sides. Angles and coordinates can be calculated as needed.
  \end{itemize}
  \end{block}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Polygons}

\subsection{Polygons}

\begin{frame}[fragile,singleframe]
  \frametitle{Polygons}
  \begin{block}{Definition}
    Let's define a polygon as a closed chain of non-intersecting line
    segments. We can represent polygons by listing the $n$ vertices in
    order around its boundary.
  \end{block}
  \bigskip

\begin{verbatim}
typedef struct {
   int n;
   point p[MAXPOLY]
} polygon
\end{verbatim}

\begin{itemize}
\item We can represent the ``last'' segment by (p[(n-1)\%n],p[n\%n])
\end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Convex Polygons}
  \begin{block}{Definition}
    A polygon $P$ is convex if any line segment defined by two points
    within $P$ are contained in $P$
  \end{block}
  \bigskip

  \begin{itemize}
  \item All internal angles in a convex polygon must be $< \pi$
    radians;
  \item The sum of all angles in a convex polygon is $2\pi$;
  \item We can test a polygon by convexity by checking that all its
    angles turn to the same side. (ccw a,b,c)
  \end{itemize}

  % draw convex polygon
\end{frame}

\begin{frame}
  \frametitle{The Convex Hull}
  \begin{block}{}
    The convex hull is a basic algorithm often used to organize
    unstructured data.
  \end{block}
  
  % draw convex hull
  
\end{frame}

\begin{frame}
  \frametitle{The Graham Scan}
  \begin{block}{Simple algorithm to create a convex hull}
    \begin{itemize}
    \item select leftmost and lowest point as starting points;
    \item sort points by angle direction from the starting points;
    \item add the first point to the hull, and repeat.
    \end{itemize}
  \end{block}

  How to avoid degeneracy? (Wrap around, collinear points, repeated
  points)
\end{frame}

\begin{frame}
  \frametitle{Area of a polygon}
  \begin{block}{Convex Polygon}
    Add all signed triangular areas: The negative areas will
    compensate the positives.
  \end{block}
  \begin{block}{Concave Polygon}
    Picasso Algorithm: Remove ``ears'' (triangles) from the polygon,
    adding to the total area.
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{Testing if a point is inside a polygon}
\end{frame}

\section{This Week's Problems}

\subsection{Problems}
\begin{frame}
  \frametitle{Problems}
  \begin{itemize}
  \item Dog and Gopher
  \item Rope Crisis in Ropeland
  \item Herding Frosh
  \item Chainsaw Massacre
  \end{itemize}
\end{frame}

\end{document}
